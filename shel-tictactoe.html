<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>איקס־עיגול: כינויי גוף + שֶׁל־</title>

  <style>
    :root {
      --bg: #f7f7fb;
      --card: #ffffff;
      --ink: #1f2430;
      --muted: #6b7280;
      --accent: #0ea5e9;
      --x: #1e40af;
      --o: #b91c1c;
      --win: #10b98122;
      --good-bg: #ecfdf5;
      --good-border: #16a34a;
      --good-text: #0a7a2f;
      --bad-bg: #fff1f2;
      --bad-border: #ef4444;
      --bad-text: #9f1239;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Noto Sans Hebrew", Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      padding: 24px;
      line-height: 1.35;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 1.6rem;
    }

    .app {
      max-width: 900px;
      margin: 0 auto;
      position: relative;
    }

    .topbar {
      display: grid;
      gap: 12px;
      grid-template-columns: 1fr;
      align-items: start;
    }
    @media (min-width: 760px){
      .topbar { grid-template-columns: 1fr auto; }
    }

    .panel {
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    .status {
      font-size: 1.05rem;
    }
    .status .turn {
      font-weight: 700;
    }

    .legend {
      font-size: 0.95rem;
      color: var(--muted);
      display: flex;
      gap: 14px;
      align-items: center;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .dot.x { background: var(--x); }
    .dot.o { background: var(--o); }

    .scoreboard {
      margin-top: 10px;
      font-size: .95rem;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      color: var(--ink);
    }
    .scoreItem {
      background: var(--card);
      border: 2px solid rgba(0,0,0,0.05);
      border-radius: 10px;
      padding: 6px 10px;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.05);
      font-weight: 600;
      min-width: 70px;
      justify-content: center;
    }
    .scoreX .dot { background: var(--x); }
    .scoreO .dot { background: var(--o); }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      border: 1px solid #e5e7eb;
      background: #fff;
      color: var(--ink);
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.95rem;
      transition: transform .05s ease, box-shadow .15s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    button:hover { transform: translateY(-1px); }
    button:active { transform: translateY(0); }
    .btn-primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .board {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .cell {
      position: relative;
      aspect-ratio: 1 / 1;
      border-radius: 16px;
      overflow: hidden;
      background: var(--card);
      box-shadow: 0 8px 28px rgba(0,0,0,0.08);
      display: grid;
      place-items: center;
      cursor: pointer;
      user-select: none;
    }

    .cell.disabled {
      cursor: not-allowed;
      opacity: 0.9;
    }

    .content {
      width: 100%;
      height: 100%;
      display: grid;
      place-items: center;
      padding: 10px;
      position: relative;
    }

    .front,
    .back {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 10px;
      text-align: center;
    }

    .front {
      font-size: clamp(20px, 4.2vw, 34px);
      font-weight: 800;
    }

    .back {
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease;
    }

    .cell.revealed .back {
      opacity: 1;
      pointer-events: auto;
    }
    .cell.revealed .front {
      opacity: 0.2;
    }

    .verb {
      font-size: clamp(18px, 3.8vw, 28px);
      font-weight: 700;
      margin-bottom: 8px;
      text-align: center;
      line-height: 1.2;
    }

    .choice {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: center;
    }

    /* smaller answer buttons */
    .choice button {
      font-size: 0.8rem;
      line-height: 1.2;
      padding: 4px 8px;
      min-width: auto;
    }

    .choice button.correct {
      border-color: var(--good-border);
      color: var(--good-text);
      background: var(--good-bg);
    }
    .choice button.wrong {
      border-color: var(--bad-border);
      color: var(--bad-text);
      background: var(--bad-bg);
    }

    .mark {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      pointer-events: none;
    }

    .glyph {
      font-size: clamp(56px, 10vw, 88px);
      font-weight: 900;
      letter-spacing: -4px;
      text-shadow: 0 8px 22px rgba(0,0,0,0.15);
    }

    .glyph.x { color: var(--x); }
    .glyph.o { color: var(--o); }

    .cell.win {
      outline: 5px solid var(--win);
    }

    /* Winner banner overlay */
    .winnerBanner {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
    }
    .winnerBox {
      background: var(--card);
      border-radius: 20px;
      padding: 24px 28px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.4);
      text-align: center;
      min-width: 250px;
      max-width: 90vw;
    }
    .winnerText {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .winnerClose {
      border: 2px solid var(--accent);
      background: var(--accent);
      color: #fff;
      border-radius: 10px;
      padding: 8px 14px;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 600;
    }
    .winnerClose:hover {
      transform: translateY(-1px);
    }

    details summary {
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 8px;
    }

    details ul {
      margin: 0;
      padding-right: 1.2rem;
      font-size: 0.9rem;
      color: var(--muted);
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="panel">
        <h1>איקס־עיגול • כינויי גוף + שֶׁל־</h1>

        <p class="status" id="status">
          שחקן: <span class="turn">X</span>
        </p>

        <p class="legend">
          <span class="badge"><span class="dot x"></span> X</span>
          <span class="badge"><span class="dot o"></span> O</span>
        </p>

        <div class="scoreboard">
          <div class="scoreItem scoreX"><span class="dot"></span> X: <span id="scoreX">0</span></div>
          <div class="scoreItem scoreO"><span class="dot"></span> O: <span id="scoreO">0</span></div>
        </div>
      </div>

      <div class="panel controls">
        <button class="btn-primary" id="reset">משחק חדש</button>
      </div>
    </div>

    <div id="board" class="board" aria-label="לוח איקס־עיגול"></div>

    <div class="panel" style="margin-top:16px">
      <details>
        <summary>הוראות</summary>
        <ul>
          <li>לחיצה על תא חושפת את הצורה: שֶׁלִּי / שֶׁלְּךָ / שֶׁלּוֹ וכו׳.</li>
          <li>"נכון" = התא לשחקן שמוצג למעלה (השחקן הנוכחי).</li>
          <li>"לא נכון" = התא עובר לשחקן האחר.</li>
          <li>אם מישהו משלים שלושה ברצף, הוא מקבל נקודה.</li>
          <li>במשחק הבא השחקן מתחלף אוטומטית.</li>
          <li>בכל משחק: 9 מתוך 10 צורות שייכות, בסדר אקראי.</li>
        </ul>
      </details>
    </div>
  </div>

  <!-- Winner overlay -->
  <div class="winnerBanner" id="winnerBanner" role="alertdialog" aria-modal="true">
    <div class="winnerBox">
      <div class="winnerText" id="winnerText">ניצחון!</div>
      <button class="winnerClose" id="winnerClose">אישור</button>
    </div>
  </div>

  <script>
    // DATA: pronouns and their "של־" possessive forms
    const POSESSION_FORMS = {
      "אני":   "שֶׁלִּי",
      "אתה":  "שֶׁלְּךָ",
      "את":    "שֶׁלָּךְ",
      "הוא":   "שֶׁלּוֹ",
      "היא":   "שֶׁלָּהּ",
      "אנחנו":"שֶׁלָּנוּ",
      "אתם":  "שֶׁלָּכֶם",
      "אתן":  "שֶׁלָּכֶן",
      "הם":   "שֶׁלָּהֶם",
      "הן":   "שֶׁלָּהֶן"
    };

    // GAME STATE
    let boardState = Array(9).fill(null); // 'X' | 'O' | null
    let currentPlayer = 'X'; // who "owns" this round
    let nextPlayer = 'X';    // who will own NEXT round, flipped each new game
    let gameOver = false;

    // running score
    let scoreX = 0;
    let scoreO = 0;

    // DOM refs
    const boardEl      = document.getElementById('board');
    const statusEl     = document.getElementById('status');
    const resetBtn     = document.getElementById('reset');
    const winnerBanner = document.getElementById('winnerBanner');
    const winnerTextEl = document.getElementById('winnerText');
    const winnerClose  = document.getElementById('winnerClose');
    const scoreXEl     = document.getElementById('scoreX');
    const scoreOEl     = document.getElementById('scoreO');

    // lines that count as a win
    const LINES = [
      [0,1,2],[3,4,5],[6,7,8], // rows
      [0,3,6],[1,4,7],[2,5,8], // cols
      [0,4,8],[2,4,6]          // diagonals
    ];

    // HELPERS
    function shuffleArray(arr){
      const out = arr.slice();
      for (let i = out.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [out[i], out[j]] = [out[j], out[i]];
      }
      return out;
    }

    // randomly choose 9 pairs from the 10 and return [{pronoun, form}, ...]
    function pickNineRandomPairs(){
      const entries = Object.entries(POSESSION_FORMS); // [ [pronoun, form], ... ]
      const shuffled = shuffleArray(entries);
      const nine = shuffled.slice(0,9);
      return nine.map(([pronoun, form]) => ({ pronoun, form }));
    }

    function updateStatus(){
      statusEl.innerHTML = 'שחקן: <span class="turn">' + currentPlayer + '</span>';
    }

    function updateScoreboard(){
      scoreXEl.textContent = scoreX;
      scoreOEl.textContent = scoreO;
    }

    function showWinnerBanner(winner){
      winnerTextEl.textContent = '🎉 ניצחון ל־' + winner + '!';
      winnerBanner.style.display = 'flex';
    }

    function hideWinnerBanner(){
      winnerBanner.style.display = 'none';
    }

    function checkWin(){
      for (const [a,b,c] of LINES){
        if (
          boardState[a] &&
          boardState[a] === boardState[b] &&
          boardState[a] === boardState[c]
        ) {
          return [a,b,c];
        }
      }
      return null;
    }

    function highlightWin(indices){
      indices.forEach(i => {
        const cell = boardEl.querySelector('.cell[data-index="' + i + '"]');
        if (cell) cell.classList.add('win');
      });
    }

    function endRound(winnerSymbol){
      gameOver = true;
      if (winnerSymbol === 'X') scoreX += 1;
      if (winnerSymbol === 'O') scoreO += 1;
      updateScoreboard();

      statusEl.innerHTML = '🎉 ניצחון ל־<span class="turn">' + winnerSymbol + '</span>!';
      showWinnerBanner(winnerSymbol);
    }

    function checkForTieIfNoWin() {
      const allDisabled = Array
        .from(document.querySelectorAll('.cell'))
        .every(c => c.classList.contains('disabled'));

      if (allDisabled && !gameOver) {
        gameOver = true;
        statusEl.textContent = 'תיקו!';
      }
    }

    // CLAIMING SQUARES
    // symbol is either the current player ("נכון") or the other player ("לא נכון")
    function claimSquare(index, symbol, cell){
      boardState[index] = symbol;

      // visually lock & reveal
      cell.classList.add('disabled');
      cell.classList.add('revealed');

      // put X/O mark on board
      const glyph = document.createElement('div');
      glyph.className = 'glyph ' + symbol.toLowerCase();
      glyph.textContent = symbol;
      cell.querySelector('.mark').appendChild(glyph);

      // check winner
      const winLine = checkWin();
      if (winLine) {
        highlightWin(winLine);
        endRound(symbol);
        return;
      }

      // or tie
      checkForTieIfNoWin();
    }

    // ROUND SETUP
    function initGame(){
      hideWinnerBanner();

      // set this round's player, then flip nextPlayer for the NEXT round
      currentPlayer = nextPlayer;
      nextPlayer = (nextPlayer === 'X') ? 'O' : 'X';

      boardState = Array(9).fill(null);
      gameOver = false;

      // pick 9 random pairs, shuffle their placement
      const pairs = pickNineRandomPairs();
      const cardsThisRound = shuffleArray(pairs);

      // rebuild board
      boardEl.innerHTML = '';
      cardsThisRound.forEach((card, idx) => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.index = idx;
        cell.setAttribute('role','button');
        cell.setAttribute('aria-label','תא ' + (idx + 1) + ': ' + card.pronoun);

        cell.innerHTML = `
          <div class="content">
            <div class="front">${card.pronoun}</div>
            <div class="back">
              <div>
                <div class="verb">${card.form}</div>
                <div class="choice">
                  <button class="correct" aria-label="נכון">נכון</button>
                  <button class="wrong" aria-label="לא נכון">לא נכון</button>
                </div>
              </div>
            </div>
            <div class="mark" aria-hidden="true"></div>
          </div>
        `;

        // reveal on click (unless already chosen or game ended)
        cell.addEventListener('click', (e) => {
          if (gameOver) return;
          if (cell.classList.contains('disabled')) return;
          if (e.target && (e.target.matches('.correct') || e.target.matches('.wrong'))) return;
          cell.classList.add('revealed');
        });

        const correctBtn = cell.querySelector('.correct');
        const wrongBtn   = cell.querySelector('.wrong');

        // "נכון" → square for currentPlayer
        correctBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          if (gameOver) return;
          if (cell.classList.contains('disabled')) return;
          claimSquare(idx, currentPlayer, cell);
        });

        // "לא נכון" → square for the OTHER player
        wrongBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          if (gameOver) return;
          if (cell.classList.contains('disabled')) return;
          const other = (currentPlayer === 'X') ? 'O' : 'X';
          claimSquare(idx, other, cell);
        });

        boardEl.appendChild(cell);
      });

      updateStatus();
      updateScoreboard();
    }

    // EVENTS
    resetBtn.addEventListener('click', () => {
      initGame(); // also switches who will play the next round
    });

    winnerClose.addEventListener('click', () => {
      hideWinnerBanner();
    });

    // first load
    initGame();
  </script>
</body>
</html>
