<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>איקס־עיגול: כינויי גוף וזמן עבר</title>

  <style>
    :root {
      --bg: #f7f7fb;
      --card: #ffffff;
      --ink: #1f2430;
      --muted: #6b7280;
      --accent: #0ea5e9;
      --x: #1e40af;
      --o: #b91c1c;
      --win: #10b98122;
      --good-bg: #ecfdf5;
      --good-border: #16a34a;
      --good-text: #0a7a2f;
      --bad-bg: #fff1f2;
      --bad-border: #ef4444;
      --bad-text: #9f1239;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Noto Sans Hebrew", Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      padding: 24px;
      line-height: 1.35;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 1.6rem;
    }

    .app {
      max-width: 900px;
      margin: 0 auto;
      position: relative;
    }

    .topbar {
      display: grid;
      gap: 12px;
      grid-template-columns: 1fr;
      align-items: start;
    }
    @media (min-width: 760px){
      .topbar { grid-template-columns: 1fr auto; }
    }

    .panel {
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    .status {
      font-size: 1.05rem;
    }
    .status .turn {
      font-weight: 700;
    }

    .infVerb {
      font-size: .9rem;
      color: var(--muted);
      margin-top: 4px;
    }
    .infVerb .verbName {
      font-weight: 600;
      color: var(--ink);
    }

    .legend {
      font-size: 0.95rem;
      color: var(--muted);
      display: flex;
      gap: 14px;
      align-items: center;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .dot.x { background: var(--x); }
    .dot.o { background: var(--o); }

    .scoreboard {
      margin-top: 10px;
      font-size: .95rem;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      color: var(--ink);
    }
    .scoreItem {
      background: var(--card);
      border: 2px solid rgba(0,0,0,0.05);
      border-radius: 10px;
      padding: 6px 10px;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.05);
      font-weight: 600;
      min-width: 70px;
      justify-content: center;
    }
    .scoreX .dot { background: var(--x); }
    .scoreO .dot { background: var(--o); }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      border: 1px solid #e5e7eb;
      background: #fff;
      color: var(--ink);
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.95rem;
      transition: transform .05s ease, box-shadow .15s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    button:hover { transform: translateY(-1px); }
    button:active { transform: translateY(0); }
    .btn-primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    .btn-ghost {
      background: transparent;
    }

    .board {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .cell {
      position: relative;
      aspect-ratio: 1 / 1;
      border-radius: 16px;
      overflow: hidden;
      background: var(--card);
      box-shadow: 0 8px 28px rgba(0,0,0,0.08);
      display: grid;
      place-items: center;
      cursor: pointer;
      user-select: none;
    }

    .cell.disabled {
      cursor: not-allowed;
      opacity: 0.9;
    }

    .content {
      width: 100%;
      height: 100%;
      display: grid;
      place-items: center;
      padding: 10px;
      position: relative;
    }

    .front,
    .back {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 10px;
      text-align: center;
    }

    .front {
      font-size: clamp(20px, 4.2vw, 34px);
      font-weight: 800;
    }

    .back {
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease;
    }

    .cell.revealed .back {
      opacity: 1;
      pointer-events: auto;
    }
    .cell.revealed .front {
      opacity: 0.2;
    }

    .verb {
      font-size: clamp(18px, 3.8vw, 28px);
      font-weight: 700;
      margin-bottom: 10px;
      text-align: center;
      line-height: 1.2;
    }

    .choice {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .choice button.correct {
      border-color: var(--good-border);
      color: var(--good-text);
      background: var(--good-bg);
    }
    .choice button.wrong {
      border-color: var(--bad-border);
      color: var(--bad-text);
      background: var(--bad-bg);
    }

    .mark {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      pointer-events: none;
    }

    .glyph {
      font-size: clamp(56px, 10vw, 88px);
      font-weight: 900;
      letter-spacing: -4px;
      text-shadow: 0 8px 22px rgba(0,0,0,0.15);
    }

    .glyph.x { color: var(--x); }
    .glyph.o { color: var(--o); }

    .cell.win {
      outline: 5px solid var(--win);
    }

    /* Winner banner overlay */
    .winnerBanner {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: none; /* flex on win */
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
    }
    .winnerBox {
      background: var(--card);
      border-radius: 20px;
      padding: 24px 28px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.4);
      text-align: center;
      min-width: 250px;
      max-width: 90vw;
    }
    .winnerText {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .winnerClose {
      border: 2px solid var(--accent);
      background: var(--accent);
      color: #fff;
      border-radius: 10px;
      padding: 8px 14px;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 600;
    }
    .winnerClose:hover {
      transform: translateY(-1px);
    }

    details summary {
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 8px;
    }

    details ul {
      margin: 0;
      padding-right: 1.2rem;
      font-size: 0.9rem;
      color: var(--muted);
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="panel">
        <h1>איקס־עיגול • כינויי גוף ← עבר</h1>
        <p class="status" id="status">תור <span class="turn">X</span>.</p>
        <p class="infVerb">פועל: <span class="verbName" id="verbInf">להזמין</span></p>

        <p class="legend">
          <span class="badge"><span class="dot x"></span> X = שחקן 1</span>
          <span class="badge"><span class="dot o"></span> O = שחקן 2</span>
        </p>

        <div class="scoreboard">
          <div class="scoreItem scoreX"><span class="dot"></span> X: <span id="scoreX">0</span></div>
          <div class="scoreItem scoreO"><span class="dot"></span> O: <span id="scoreO">0</span></div>
        </div>
      </div>

      <div class="panel controls">
        <button class="btn-primary" id="reset">משחק חדש</button>
        <button class="btn-ghost" id="swapStart">החלפת פותח (X/O)</button>
      </div>
    </div>

    <div id="board" class="board" aria-label="לוח איקס־עיגול"></div>

    <div class="panel" style="margin-top:16px">
      <details>
        <summary>הערות למורה / התאמה אישית</summary>
        <ul>
          <li>לחיצה על תא חושפת את צורת הפועל בגוף ובזמן עבר.</li>
          <li>"צדקתי" = התא לשחקן שבתור (X או O).</li>
          <li>"טעיתי" = התא עובר לשחקן השני.</li>
          <li>המשחק מסמן ניצחון (שורה/טור/אלכסון).</li>
          <li>בכל משחק חדש: הלוח מתערבב וגם הפועל מתחלף.</li>
          <li>הניקוד (X/O) נשמר בין משחקים.</li>
        </ul>
      </details>
    </div>
  </div>

  <!-- Winner overlay -->
  <div class="winnerBanner" id="winnerBanner" role="alertdialog" aria-modal="true">
    <div class="winnerBox">
      <div class="winnerText" id="winnerText">ניצחון!</div>
      <button class="winnerClose" id="winnerClose">אישור</button>
    </div>
  </div>

  <script>
    // --------------------------------------
    // DATA
    // --------------------------------------

    // Pronouns for board positions
    const PRONOUNS = [
      "אני",
      "אתה",
      "את",
      "הוא",
      "היא",
      "אנחנו",
      "אתם",
      "אתן",
      "הם"
    ];

    // Verb sets. Each has an infinitive and all past tense forms by pronoun.
    const VERB_SETS = [
      {
        inf: "להזמין",
        forms: {
          "אני": "הזמנתי",
          "אתה": "הזמנתָ",
          "את": "הזמנתְ",
          "הוא": "הזמין",
          "היא": "הזמינה",
          "אנחנו": "הזמנו",
          "אתם": "הזמנתם",
          "אתן": "הזמנתן",
          "הם": "הזמינו"
        }
      },
      {
        inf: "להתחיל",
        forms: {
          "אני": "התחלתי",
          "אתה": "התחלת",
          "את": "התחלת",
          "הוא": "התחיל",
          "היא": "התחילה",
          "אנחנו": "התחלנו",
          "אתם": "התחלתם",
          "אתן": "התחלתן",
          "הם": "התחילו"
        }
      },
      {
        inf: "להסכים",
        forms: {
          "אני": "הסכמתי",
          "אתה": "הסכמת",
          "את": "הסכמת",
          "הוא": "הסכים",
          "היא": "הסכימה",
          "אנחנו": "הסכמנו",
          "אתם": "הסכמתם",
          "אתן": "הסכמתן",
          "הם": "הסכימו"
        }
      },
      {
        inf: "להרגיש",
        forms: {
          "אני": "הרגשתי",
          "אתה": "הרגשת",
          "את": "הרגשת",
          "הוא": "הרגיש",
          "היא": "הרגישה",
          "אנחנו": "הרגשנו",
          "אתם": "הרגשתם",
          "אתן": "הרגשתן",
          "הם": "הרגישו"
        }
      },
      {
        inf: "להמשיך",
        forms: {
          "אני": "המשכתי",
          "אתה": "המשכת",
          "את": "המשכת",
          "הוא": "המשיך",
          "היא": "המשיכה",
          "אנחנו": "המשכנו",
          "אתם": "המשכתם",
          "אתן": "המשכתן",
          "הם": "המשיכו"
        }
      },
      {
        inf: "להפסיק",
        forms: {
          "אני": "הפסקתי",
          "אתה": "הפסקת",
          "את": "הפסקת",
          "הוא": "הפסיק",
          "היא": "הפסיקה",
          "אנחנו": "הפסקנו",
          "אתם": "הפסקתם",
          "אתן": "הפסקתן",
          "הם": "הפסיקו"
        }
      },
      {
        inf: "להצליח",
        forms: {
          "אני": "הצלחתי",
          "אתה": "הצלחת",
          "את": "הצלחת",
          "הוא": "הצליח",
          "היא": "הצליחה",
          "אנחנו": "הצלחנו",
          "אתם": "הצלחתם",
          "אתן": "הצלחתן",
          "הם": "הצליחו"
        }
      },
      {
        inf: "להקשיב",
        forms: {
          "אני": "הקשבתי",
          "אתה": "הקשבת",
          "את": "הקשבת",
          "הוא": "הקשיב",
          "היא": "הקשיבה",
          "אנחנו": "הקשבנו",
          "אתם": "הקשבתם",
          "אתן": "הקשבתן",
          "הם": "הקשיבו"
        }
      },
      {
        inf: "להאמין",
        forms: {
          "אני": "האמנתי",
          "אתה": "האמנת",
          "את": "האמנת",
          "הוא": "האמין",
          "היא": "האמינה",
          "אנחנו": "האמנו",
          "אתם": "האמנתם",
          "אתן": "האמנתן",
          "הם": "האמינו"
        }
      },
      {
        inf: "להשפיע",
        forms: {
          "אני": "השפעתי",
          "אתה": "השפעת",
          "את": "השפעת",
          "הוא": "השפיע",
          "היא": "השפיעה",
          "אנחנו": "השפענו",
          "אתם": "השפעתם",
          "אתן": "השפעתן",
          "הם": "השפיעו"
        }
      },
      {
        inf: "להחליט",
        forms: {
          "אני": "החלטתי",
          "אתה": "החלטת",
          "את": "החלטת",
          "הוא": "החליט",
          "היא": "החליטה",
          "אנחנו": "החלטנו",
          "אתם": "החלטתם",
          "אתן": "החלטתן",
          "הם": "החליטו"
        }
      },
      {
        inf: "להסביר",
        forms: {
          "אני": "הסברתי",
          "אתה": "הסברת",
          "את": "הסברת",
          "הוא": "הסביר",
          "היא": "הסבירה",
          "אנחנו": "הסברנו",
          "אתם": "הסברתם",
          "אתן": "הסברתן",
          "הם": "הסבירו"
        }
      },
      {
        inf: "להצחיק",
        forms: {
          "אני": "הצחקתי",
          "אתה": "הצחקת",
          "את": "הצחקת",
          "הוא": "הצחיק",
          "היא": "הצחיקה",
          "אנחנו": "הצחקנו",
          "אתם": "הצחקתם",
          "אתן": "הצחקתן",
          "הם": "הצחיקו"
        }
      }
    ];

    // --------------------------------------
    // GAME STATE
    // --------------------------------------

    let boardState = Array(9).fill(null); // 'X' | 'O' | null
    let currentPlayer = 'X';
    let gameOver = false;
    let starter = 'X'; // who starts next round ('X' or 'O')
    let shuffledCards = []; // [{pronoun, verb}, ...] for current board
    let verbSetIndex = -1;  // rotates through VERB_SETS

    // running score across rounds
    let scoreX = 0;
    let scoreO = 0;

    // DOM refs
    const boardEl      = document.getElementById('board');
    const statusEl     = document.getElementById('status');
    const resetBtn     = document.getElementById('reset');
    const swapBtn      = document.getElementById('swapStart');
    const verbInfEl    = document.getElementById('verbInf');
    const scoreXEl     = document.getElementById('scoreX');
    const scoreOEl     = document.getElementById('scoreO');
    const winnerBanner = document.getElementById('winnerBanner');
    const winnerTextEl = document.getElementById('winnerText');
    const winnerClose  = document.getElementById('winnerClose');

    const LINES = [
      [0,1,2],[3,4,5],[6,7,8], // rows
      [0,3,6],[1,4,7],[2,5,8], // cols
      [0,4,8],[2,4,6]          // diagonals
    ];

    // helper: opponent
    function opponentOf(p){
      return p === 'X' ? 'O' : 'X';
    }

    // helper: shuffle
    function shuffleArray(arr){
      const out = arr.slice();
      for (let i = out.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [out[i], out[j]] = [out[j], out[i]];
      }
      return out;
    }

    // build cards (pronoun→form) for chosen verb set
    function buildCardsFromVerbSet(vset){
      return PRONOUNS.map(p => {
        return {
          pronoun: p,
          verb: vset.forms[p]
        };
      });
    }

    function updateStatus(){
      statusEl.innerHTML = 'תור <span class="turn">' + currentPlayer + '</span>.';
    }

    function updateScoreboard(){
      scoreXEl.textContent = scoreX;
      scoreOEl.textContent = scoreO;
    }

    function showWinnerBanner(winner){
      winnerTextEl.textContent = '🎉 ניצחון ל־' + winner + '!';
      winnerBanner.style.display = 'flex';
    }

    function hideWinnerBanner(){
      winnerBanner.style.display = 'none';
    }

    // main: start / restart game
    function initGame(){
      // new round => hide any previous banner
      hideWinnerBanner();

      // advance which verb set we're using
      verbSetIndex = (verbSetIndex + 1) % VERB_SETS.length;
      const currentVerbSet = VERB_SETS[verbSetIndex];

      // update infinitive display
      verbInfEl.textContent = currentVerbSet.inf;

      // reset per-round state
      boardState = Array(9).fill(null);
      currentPlayer = starter;
      gameOver = false;

      // build + shuffle cards for board
      shuffledCards = shuffleArray(buildCardsFromVerbSet(currentVerbSet));

      // rebuild board DOM
      boardEl.innerHTML = '';

      shuffledCards.forEach((card, indexOnBoard) => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.index = indexOnBoard;
        cell.setAttribute('role','button');
        cell.setAttribute('aria-label','תא ' + (indexOnBoard + 1) + ': ' + card.pronoun);

        cell.innerHTML = `
          <div class="content">
            <div class="front">${card.pronoun}</div>
            <div class="back">
              <div>
                <div class="verb">${card.verb}</div>
                <div class="choice">
                  <button class="correct" aria-label="צדקתי">צדקתי</button>
                  <button class="wrong" aria-label="טעיתי">טעיתי</button>
                </div>
              </div>
            </div>
            <div class="mark" aria-hidden="true"></div>
          </div>
        `;

        // reveal pronoun→verb unless already taken or game over
        cell.addEventListener('click', (e) => {
          if (gameOver) return;
          const idx = Number(cell.dataset.index);
          if (boardState[idx]) return; // already marked
          // don't fire if we clicked one of the small buttons
          if (e.target && (e.target.matches('.correct') || e.target.matches('.wrong'))) return;
          cell.classList.add('revealed');
        });

        // mark buttons
        const correctBtn = cell.querySelector('.correct');
        const wrongBtn   = cell.querySelector('.wrong');

        correctBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          claimSquare(indexOnBoard, currentPlayer); // keep square
        });

        wrongBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          claimSquare(indexOnBoard, opponentOf(currentPlayer)); // give square to opponent
        });

        boardEl.appendChild(cell);
      });

      updateStatus();
      updateScoreboard();
    }

    function claimSquare(index, symbol){
      if (gameOver) return;
      if (boardState[index]) return; // already taken

      boardState[index] = symbol;
      const cell = boardEl.querySelector('.cell[data-index="' + index + '"]');
      cell.classList.add('disabled');

      const glyph = document.createElement('div');
      glyph.className = 'glyph ' + symbol.toLowerCase();
      glyph.textContent = symbol;
      cell.querySelector('.mark').appendChild(glyph);

      const winLine = checkWin();
      if (winLine) {
        gameOver = true;
        highlightWin(winLine);
        // update scoreboard
        if (symbol === 'X') {
          scoreX += 1;
        } else {
          scoreO += 1;
        }
        updateScoreboard();
        statusEl.innerHTML = '🎉 ניצחון ל־<span class="turn">' + symbol + '</span>!';
        showWinnerBanner(symbol);
        return;
      }

      if (boardState.every(x => x !== null)) {
        gameOver = true;
        statusEl.textContent = 'תיקו!';
        return;
      }

      currentPlayer = opponentOf(currentPlayer);
      updateStatus();
    }

    function checkWin(){
      for (const [a,b,c] of LINES){
        if (boardState[a] && boardState[a] === boardState[b] && boardState[a] === boardState[c]) {
          return [a,b,c];
        }
      }
      return null;
    }

    function highlightWin(indices){
      indices.forEach(i => {
        const cell = boardEl.querySelector('.cell[data-index="' + i + '"]');
        if (cell) cell.classList.add('win');
      });
    }

    // Buttons / UI actions
    resetBtn.addEventListener('click', () => {
      initGame();
    });

    swapBtn.addEventListener('click', () => {
      starter = opponentOf(starter);
      initGame();
    });

    winnerClose.addEventListener('click', () => {
      hideWinnerBanner();
    });

    // first load
    initGame();
  </script>
</body>
</html>
